create table query1 as select genres.name as genre, count(*) as moviecount from genres inner join hasagenre on genres.genreid= hasagenre.genreid group by genres.name;
create table query2 as select gen.name as name, rat.avg as rating from genres as gen inner join (select hasagenre.genreid,avg(ratings.rating) from ratings inner join hasagenre on ratings.movieid= hasagenre.movieid group by hasagenre.genreid) as rat on gen.genreid=rat.genreid;
create table query3 as select mov.title as title,rat.count as countofratings from movies as mov inner join (select movieid, count(*) from ratings group by movieid having count(*)>10) as rat on mov.movieid=rat.movieid;
create table query4 as select mov.movieid as movieid, mov.title as title from movies as mov inner join (select hasagenre.movieid from hasagenre  inner join genres on hasagenre.genreid=genres.genreid where genres.name like 'Comedy') as hasgen on hasgen.movieid=mov.movieid;
create table query5 as select movies.title as title, rat.avg as average from movies inner join (select movieid, avg(rating) from ratings group by movieid) as rat on movies.movieid=rat.movieid;
create table query6 as select avg(rating) as average from ratings where movieid in (select hasagenre.movieid from hasagenre inner join genres on hasagenre.genreid=genres.genreid where genres.name='Comedy');
create table query7 as select avg(rating) as average from ratings where movieid in (select hasagenre.movieid from hasagenre inner join genres on hasagenre.genreid=genres.genreid where genres.name='Comedy') and movieid in (select hasagenre.movieid from hasagenre inner join genres on hasagenre.genreid=genres.genreid where genres.name='Romance');
create table query8 as select avg(rating) as average from ratings where movieid not in (select hasagenre.movieid from hasagenre inner join genres on hasagenre.genreid=genres.genreid where genres.name='Comedy') and movieid in (select hasagenre.movieid from hasagenre inner join genres on hasagenre.genreid=genres.genreid where genres.name='Romance');
create table query9 as select movieid,rating from ratings where userid=:v1;
create table moviesaverageratings as select movies.movieid as movieid, rat.avg as average from movies inner join (select movieid, avg(rating) from ratings group by movieid) as rat on movies.movieid=rat.movieid;
create table similarity as select mar1.movieid as movieid1, mar2.movieid as movieid2,1-abs(mar1.average-mar2.average)/5 as sim from moviesaverageratings mar1 , moviesaverageratings mar2;
create table recommendation as select title from(select sum(sim.sim*rat.rating)/sum(sim.sim) as pridictrate,sim.movieid2 from (select * from similarity where movieid1 in (select movieid from ratings where userid=:v1) and movieid2 in (select movieid from movies where movieid not in (select movieid from ratings where userid=:v1)))as sim, ratings rat where rat.movieid=sim.movieid1 and rat.userid=:v1 group by sim.movieid2 having sum(sim.sim*rat.rating)/sum(sim.sim)>3.9) as recomendation, movies where recomendation.movieid2=movies.movieid;